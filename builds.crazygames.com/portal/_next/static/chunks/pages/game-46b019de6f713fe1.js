(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[79203],{10134:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/game",function(){return a(41294)}])},41294:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Q}});var r=a(85893),n=a(11163),s=a.n(n),i=a(67294),o=a(18288),l=a(46313),c=a(44715),d=a(96851),u=a(88642),m=a(54596),p=a(70133),g=a(56171),h=a(84973),v=a(92975),f=a(89950);class y extends i.PureComponent{componentDidMount(){"serviceWorker"in navigator&&("complete"!==document.readyState?window.addEventListener("load",this.onLoad):this.onLoad())}componentWillUnmount(){window.removeEventListener("load",this.onLoad),window.removeEventListener("beforeinstallprompt",this.onBeforeInstallPrompt),window.removeEventListener("appinstalled",this.onAppInstall),window.removeEventListener("message",this.processMessage)}render(){return null}onLoad=()=>{this.registerSW(),window.addEventListener("beforeinstallprompt",this.onBeforeInstallPrompt),window.addEventListener("appinstalled",this.onAppInstall),window.addEventListener("message",this.processMessage)};processMessage=e=>{if(!e.origin||!e.data||e.data.type!==f.V)return;let{game:t,routeHelper:a}=this.props,r=t.desktopUrl,n=a.isMessageFromGameframe(e,r);if(n){if("addGamePWA"===e.data.event){let t=e.data.source;(0,g.rV)(t),this.props.services.analyticsService.trackPWAGameInstalled(!0,this.props.game.slug,t)}"cancelGamePWAInstall"===e.data.event&&this.props.services.analyticsService.trackPWAGameInstalled(!1,this.props.game.slug,"popup")}};onBeforeInstallPrompt=e=>{e.preventDefault(),(0,g.hZ)(e),this.trackInstallEvent(e)};onAppInstall=()=>{(0,g.Bc)(),this.props.services.analyticsService.trackPWAGameInstalled(!0,this.props.game.slug,"browser-event")};trackInstallEvent=e=>{e.userChoice.then(e=>{"accepted"!==e.outcome&&this.props.services.analyticsService.trackPWAGameInstalled(!1,this.props.game.slug)})};registerSW=()=>{if("serviceWorker"in navigator){let{routeHelper:e}=this.props,t=e.gamePageLinkPrefix(),a=e.toRelativeLink(t);navigator.serviceWorker.register("/sw-game.js",{scope:a}).then(e=>{console.log("[GSW] registration successful")},e=>console.log("[GSW] registration failed: ",e))}}}var w=(0,p.Z)((0,h.Z)((0,v.Z)(y))),D=a(13301),k=a(60081),x=a(37899);let G=e=>{let{game:t}=e,{analyticsService:a}=i.useContext(x.Z).services;return i.useEffect(()=>(a.setLoaderType(t.technology),function(){a.unsetLoaderType()}),[t,a]),null};var P=a(91096),b=a(4498),E=a(39471),I=a(26832),L=a(50319),S=a(73359),Z=a(50456);let j=Z.ZP`
  query GameData($id: String!, $technology: GameTechnologyAPS) {
    gameData(id: $id, technology: $technology) {
      dataUrl
      version
      metadata {
        updatedAt
        browser
        deviceType
        playedTime
      }
    }
  }
`,W=Z.ZP`
  mutation ReplaceGameData($input: AddGameDataInput!) {
    replaceGameData(input: $input)
  }
`,A=Z.ZP`
  mutation ClearGameData($input: ClearGameDataInput!) {
    clearGameData(input: $input)
  }
`;var C=a(74040),_=a(95129),R=a(42257);async function T(e){let t=await fetch(e,{method:"GET"}),a=await t.text();return a}let $=e=>{let{gameId:t,gameTechnology:a}=e,{user:r}=i.useContext(C.S),n=i.useContext(_.Z),s=i.useContext(R.ZP),[o]=(0,L.D)(W),[l]=(0,L.D)(A),[c,d]=(0,S.t)(j),u=i.useRef([]);return i.useEffect(()=>{if(!d.called||d.loading)return;let e=d.data?.gameData;d.error?(u.current.forEach(e=>{e({type:"requestGameDataNone"})}),u.current=[]):e&&e.dataUrl?T(e.dataUrl).then(t=>{let a={...e,data:t};u.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:a,error:d.error}})}),u.current=[]}):(u.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:void 0,error:d.error}})}),u.current=[])},[d]),i.useEffect(()=>{let e=e=>{let n=t=>{let a=e.source;a&&a.postMessage(t,"*")};r?(u.current=[n,...u.current],c({variables:{id:t,technology:a},fetchPolicy:"network-only"})):u.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:void 0,error:null}})})},i=e=>{let{store:r,version:i,updatedAtTz:l,playedTime:c}=e.data,d=JSON.stringify(r),u=n.browser?.name||"",m=(0,R.cy)(s);o({variables:{input:{data:d,id:t,technology:a,version:i,browser:u,playedTime:c,deviceType:m,updatedAtTz:l}}})},d=e=>{let{version:r}=e.data,i=n.browser?.name||"",o=(0,R.cy)(s);l({variables:{input:{id:t,technology:a,version:r,browser:i,deviceType:o}}})},m=t=>{if(t.data&&t.data.type===f.V)switch(t.data.event){case"requestGameData":e(t);break;case"updateGameData":case"replaceGameData":r&&i(t);break;case"clearGameData":r&&d(t);break;default:return}};return window.addEventListener("message",m),function(){window.removeEventListener("message",m)}},[o,c,l,t,a,r,n.browser,s]),null};var M=a(8072),U=a(26830),F=a(33209),q=a(89041),N=a(68771),V=a(81792),B=a(98718),H=a(5152),O=a.n(H),z=a(90611);let J=O()(()=>Promise.all([a.e(40437),a.e(36805),a.e(64243)]).then(a.bind(a,64243)),{loadableGenerated:{webpack:()=>[64243]},loading:()=>null,ssr:!0}),K=O()(()=>Promise.all([a.e(40437),a.e(36805),a.e(5054)]).then(a.bind(a,5054)),{loadableGenerated:{webpack:()=>[5054]},loading:()=>null,ssr:!0});class X extends i.Component{static async getInitialProps(e){let{pageService:t,adUnitService:a,routeDataService:r}=(0,m.b)(e),n=e.query&&e.query[u.l1],{deviceType:i}=(0,D.mO)(e),o=(0,D.yz)(i),c=!i.isDesktop,p=c?b.gM:b.$d,[{game:g,related:h,instant:v},f,y]=await Promise.all([t.gamePage(n,p,o,b.nD),a.getAdUnitsConfig(),r.getRouteProviderData("game")]),{res:w}=e,k=(0,F.Kd)(e);if("ARCHIVED"===g.status){let t=await r.getLocaleRouteProviderData(k),a=d.Z.createFromContext(e,t);if(w){let e=this.redirectUrl(g,a,!1);w.writeHead(302,{Location:e.as}),w.end()}else{let e=this.redirectUrl(g,a,!0);s().push(e.href,e.as)}}w&&g.isKids&&(w.writeHead(302,{Location:`${l.Z.Instance.data.kids}/game/${g.slug}`}),w.end());let x=(0,U.$W)(g.slug,y);return{adConfig:f,game:g,related:h,instant:v,alternatives:x}}static redirectUrl(e,t,a){if(e.collection){let r=t.tagPageDirectLink(e.collection,{returnRelative:a});return r}{let r=t.categoryPageDirectLink(e.category.slug,{returnRelative:a});return r}}render(){let{i18n:e,game:t,adConfig:a,related:n,routeHelper:s,alternatives:i,deviceType:c,instant:d}=this.props,u={name:t.name,category:t.category.name},m=t.pageTitle?t.pageTitle:e._("game.head.title",{name:t.name}),p=t.metaDescription||e._("game.head.metaDescriptionFallback",u),g=s.gameCanonical(t.slug),h=s.manifestForGameLink(t.slug),v=l.Z.Instance.data.advertizing.domain,f=!c.isDesktop&&!t.iosFriendly&&!t.androidFriendly,y=!!t.disableAds||"UNAVAILABLE"===t.status||f||(0,N.j)(),D=t.tags.map(e=>e.enSlug||e.slug);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(P.Z,{gameSlug:t.slug,tagsSlug:D,categoryEnSlug:t.category.enSlug,disabled:y,adConfig:{...a,smartRefresh:{enabled:!!t.smartRefresh,minWaitInMs:t.minWaitForSmartRefreshInMs,maxWaitInMs:t.maxWaitForSmartRefreshInMs}},children:[(0,r.jsxs)(o.Z,{title:m,metaDescription:p,canonical:g,alternatives:i,children:[h&&(0,r.jsx)("link",{rel:"manifest",href:h}),(0,r.jsx)("meta",{name:"apple-mobile-web-app-title",content:t.name}),(0,r.jsx)("link",{rel:"preconnect",href:v}),this.renderCustomStructuredData()]}),(0,r.jsx)(k.Z,{canonical:g,title:m,description:p,imageUrl:t.cover,type:"game"}),(0,r.jsx)(V.Z,{children:(0,r.jsx)(J,{game:t,related:n})}),(0,r.jsx)(B.Z,{children:(0,r.jsx)(K,{game:t,instant:d,related:n?n.data:void 0})})]},t.slug),!f&&(0,r.jsx)(w,{game:t}),(0,r.jsx)(M.Z,{game:t},`gametracking-${t.slug}`),(0,r.jsx)(z.J,{game:t}),(0,r.jsx)(G,{game:t}),(0,r.jsx)($,{gameId:t.id,gameTechnology:t.technology}),(0,r.jsx)(q.Z,{gameId:t.id})]})}renderCustomStructuredData(){let{game:e}=this.props;if(e.customStructuredData)return(0,r.jsx)("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:e.customStructuredData}})}}var Q=(0,E.Z)((0,c.Z)("game")((0,v.V)((0,I.Z)(X))))}},function(e){e.O(0,[7581,56774,99842,1110,49774,92888,40179],function(){return e(e.s=10134)}),_N_E=e.O()}]);